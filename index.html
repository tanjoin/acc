<!DOCTYPE html>
<html>
  <head>
    <title>aac</title>
    <meta charset="utf-8">
    <meta name="description" content="acc">
    <meta name="author" content="tanjoin">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">
    <link rel="shortcut icon" href="">
  </head>
  <body>
    <div id="contents"></div>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
    <script>
      function getUrlQuery() {
        var vars = [], max = 0, hash = "", array = "";
        var url = window.location.search;

        hash  = url.slice(1).split('&');    
        max = hash.length;
        for (var i = 0; i < max; i++) {
          array = hash[i].split('=');    //keyと値に分割。
          vars.push(array[0]);    //末尾にクエリ文字列のkeyを挿入。
          vars[array[0]] = array[1];    //先ほど確保したkeyに、値を代入。
        }
        return vars;
      }
      
      window.onload = function(){       
        var query = getUrlQuery();
        var httpObj = new XMLHttpRequest();
        httpObj.open("get", "campaign.json", true);
        httpObj.onload = function() {
          var data = JSON.parse(this.responseText);
          
          var row = document.createElement("div");
          row.className = "row";
          document.getElementById("contents").appendChild(row);
                   
          for (var i = 0; i < data.campaigns.length; i++) {
            var campaign = data.campaigns[i];
            
            if (query.service_title.length > 0) {
              if (query.service_title == campaign.service_title) {
                continue;
              }
            }
            
            var start = new Date(Date.parse(campaign.date.start));
            var end = new Date(Date.parse(campaign.date.end));
            var now = new Date();
            
            if (start != null && start.getTime() > now.getTime()) {
              continue;
            }
            
            if (end != null && now.getTime() > end.getTime()) {
              continue;
            }

            var col = document.createElement("div");
            col.className = "col s12 m6 l3";
            row.appendChild(col);            
            
            if (campaign.urls.length > 0) {
              var cardLink = document.createElement("a");
              cardLink.href = campaign.urls[0];
              col.appendChild(cardLink);
              var card = document.createElement("div");
              card.className = "card blue-grey darken-3 waves-effect waves-block waves-light";
              cardLink.appendChild(card);
            } else {
              var card = document.createElement("div");
              card.className = "card blue-grey darken-3";
              col.appendChild(card);
            }
            
            if (campaign.img != null && campaign.img.length > 0) {
              var cardImage = document.createElement("div");
              var img = document.createElement("img");
              img.src = campaign.img;
              cardImage.appendChild(img);
              card.appendChild(cardImage);
            }
            
            var cardContent = document.createElement("div");
            cardContent.className = "card-content white-text";
            card.appendChild(cardContent);

            var cardId = document.createElement("div");
            cardId.className = "blue-text";
            cardId.innerText = campaign.id;
            cardContent.appendChild(cardId);
                        
            var cardTitle = document.createElement("div");
            cardTitle.className = "card-title";
            cardTitle.innerText = campaign.title;
            cardContent.appendChild(cardTitle);
            
            var cardService = document.createElement("div");
            cardService.className = "amber-text";
            cardService.innerText = campaign.service_title;
            var cardServicelink = document.createElement("a");
            cardServicelink.href = "/?service_title=" + campaign.service_title;
            cardServicelink.appendChild(cardService);
            cardContent.appendChild(cardServicelink);
                        
            var cardDay = document.createElement("div");
            cardDay.className = "grey-text";
            cardDay.innerText = campaign.date.start || '';
            cardDay.innerText += "～";
            cardDay.innerText += campaign.date.end || '';
            cardContent.appendChild(cardDay);
            
            var description = document.createElement("p");
            description.innerText = campaign.description;
            cardContent.appendChild(description);
            
            var cardAction = document.createElement("div");
            cardAction.className = "card-action";
            var isAddCardAction = false;
            for (var j = 1; j < campaign.urls.length; j++) {
              var alink = document.createElement("a");
              alink.href = campaign.urls[j];
              alink.innerText = "その" + (j+1);
              cardAction.appendChild(alink);
              isAddCardAction = true;
            }
            if (isAddCardAction) {
              cardContent.appendChild(cardAction);
            }
          }
        };
        httpObj.send(null);
      }
    </script>
  </body>
</html>
